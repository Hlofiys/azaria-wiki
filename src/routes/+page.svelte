<script>
	import LoreCard from '$lib/components/ui/LoreCard.svelte';
	import { goto } from '$app/navigation';
	
	export let data;
	
	let isSpinning = false;
	let slotResults = [];
	
	// Slot machine functionality
	async function spinSlotMachine() {
		if (isSpinning) return;
		
		isSpinning = true;
		slotResults = [];
		
		// Simulate spinning animation
		await new Promise(resolve => setTimeout(resolve, 2000));
		
		// Select 3 random entries
		const shuffled = [...data.slotMachineEntries].sort(() => Math.random() - 0.5);
		slotResults = shuffled.slice(0, 3);
		
		isSpinning = false;
	}
	
	// Quick navigation to categories
	const categories = [
		{ name: 'characters', title: '–ü–µ—Ä—Å–æ–Ω–∞–∂–∏', icon: 'üëë', description: '–í–ª–∏—è—Ç–µ–ª—å–Ω—ã–µ –ª–∏—á–Ω–æ—Å—Ç–∏' },
		{ name: 'locations', title: '–õ–æ–∫–∞—Ü–∏–∏', icon: 'üè∞', description: '–ì–æ—Ä–æ–¥–∞ –∏ –º–µ—Å—Ç–∞' },
		{ name: 'factions', title: '–§—Ä–∞–∫—Ü–∏–∏', icon: '‚öîÔ∏è', description: '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–∞ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏' },
		{ name: 'artifacts', title: '–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã', icon: '‚ú®', description: '–ú–∞–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã' },
		{ name: 'concepts', title: '–ö–æ–Ω—Ü–µ–ø—Ü–∏–∏', icon: 'üéØ', description: '–§–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã' },
		{ name: 'creatures', title: '–°—É—â–µ—Å—Ç–≤–∞', icon: 'üêâ', description: '–ú–æ–Ω—Å—Ç—Ä—ã –∏ —Å–æ–∑–¥–∞–Ω–∏—è' }
	];
</script>

<svelte:head>
	<title>–ê–∑–∞—Ä–∏—è –í–∏–∫–∏ ‚Äî –ú–µ–¥–∏–≤–∞–ª-–¥–µ–ø-–ø–∞–Ω–∫ –≤—Å–µ–ª–µ–Ω–Ω–∞—è</title>
	<meta name="description" content="–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–∏—Ä –ê–∑–∞—Ä–∏–∏ - —É–Ω–∏–∫–∞–ª—å–Ω—É—é –º–µ–¥–∏–≤–∞–ª-–¥–µ–ø-–ø–∞–Ω–∫ –≤—Å–µ–ª–µ–Ω–Ω—É—é, –≥–¥–µ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π –∞–∑–∞—Ä—Ç–∞ –∏ —É–¥–∞—á–∏." />
</svelte:head>

<div class="max-w-7xl mx-auto">
	<!-- Hero Section -->
	<div class="text-center mb-12">
		<h1 class="text-5xl md:text-7xl font-heading text-azaria-gold mb-6">
			üé∞ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∑–∞—Ä–∏—é
		</h1>
		<p class="text-xl md:text-2xl text-azaria-text/80 font-body max-w-3xl mx-auto mb-8">
			–ü–æ–≥—Ä—É–∑–∏—Ç–µ—Å—å –≤ –º–∏—Ä, –≥–¥–µ —Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è —Å —Ñ–∏–ª–æ—Å–æ—Ñ–∏–µ–π –∞–∑–∞—Ä—Ç–∞, 
			–≥–¥–µ —É–¥–∞—á–∞ –ø—Ä–∞–≤–∏—Ç –∫–æ—Ä–æ–ª–µ–≤—Å—Ç–≤–∞–º–∏, –∞ –¥–µ–ø —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏—Å–∫—É—Å—Å—Ç–≤–æ–º.
		</p>
		<div class="flex flex-wrap justify-center gap-4 text-sm text-azaria-text/60">
			<span>üìñ {data.totalEntries} —Å—Ç–∞—Ç–µ–π</span>
			<span>üëë –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</span>
			<span>üè∞ –õ–æ–∫–∞—Ü–∏–∏</span>
			<span>‚öîÔ∏è –§—Ä–∞–∫—Ü–∏–∏</span>
			<span>‚ú® –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</span>
		</div>
	</div>
	
	<!-- Slot Machine of Fate -->
	<div class="card bg-azaria-content border-2 border-azaria-gold ornate-border mb-12">
		<div class="card-body text-center">
			<h2 class="text-3xl font-heading text-azaria-gold mb-4">
				üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ –°—É–¥—å–±—ã
			</h2>
			<p class="text-azaria-text/80 font-body mb-6">
				–ü–æ–∑–≤–æ–ª—å—Ç–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞—Ç—å –≤–∞—à–µ —Å–ª–µ–¥—É—é—â–µ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≤ –º–∏—Ä–µ –ê–∑–∞—Ä–∏–∏
			</p>
			
			<!-- Slot Machine Reels -->
			<div class="flex justify-center items-center space-x-4 mb-6">
				{#each [0, 1, 2] as reelIndex}
					<div class="w-32 h-40 bg-azaria-dark border-2 border-azaria-gold rounded-lg flex flex-col justify-center items-center p-2">
						{#if isSpinning}
							<div class="loading-dice text-4xl mb-2">üé≤</div>
							<div class="text-xs text-azaria-text/50 animate-pulse">–ö—Ä—É—Ç–∏—Ç—Å—è...</div>
						{:else if slotResults[reelIndex]}
							<div class="text-2xl mb-1">
								{slotResults[reelIndex].category === 'characters' ? 'üëë' :
								 slotResults[reelIndex].category === 'locations' ? 'üè∞' :
								 slotResults[reelIndex].category === 'factions' ? '‚öîÔ∏è' :
								 slotResults[reelIndex].category === 'artifacts' ? '‚ú®' :
								 slotResults[reelIndex].category === 'concepts' ? 'üéØ' :
								 slotResults[reelIndex].category === 'creatures' ? 'üêâ' : 'üìñ'}
							</div>
							<div class="text-xs text-azaria-gold font-semibold text-center">
								{slotResults[reelIndex].title}
							</div>
						{:else}
							<div class="text-4xl mb-2">‚ùì</div>
							<div class="text-xs text-azaria-text/50">–ì–æ—Ç–æ–≤ –∫ —Å–ø–∏–Ω—É</div>
						{/if}
					</div>
				{/each}
			</div>
			
			<!-- Spin Button -->
			<button 
				on:click={spinSlotMachine}
				disabled={isSpinning}
				class="btn btn-primary btn-lg text-lg font-heading px-8"
				class:loading={isSpinning}
			>
				{isSpinning ? 'üé≤ –ö—Ä—É—Ç–∏—Ç—Å—è...' : 'üé∞ –°–ø–∏–Ω–∞–Ω—É—Ç—å —Å—É–¥—å–±—É!'}
			</button>
			
			<!-- Slot Results -->
			{#if slotResults.length > 0 && !isSpinning}
				<div class="mt-8">
					<h3 class="text-xl font-heading text-azaria-gold mb-4">
						‚ú® –°—É–¥—å–±–∞ –≤—ã–±—Ä–∞–ª–∞ –¥–ª—è –≤–∞—Å:
					</h3>
					<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
						{#each slotResults as entry}
							<LoreCard {entry} showCategory={true} />
						{/each}
					</div>
				</div>
			{/if}
		</div>
	</div>
	
	<!-- Category Navigation -->
	<div class="mb-12">
		<h2 class="text-3xl font-heading text-azaria-gold mb-6 text-center">
			üìö –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–∏—Ä –ê–∑–∞—Ä–∏–∏
		</h2>
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{#each categories as category}
				<a 
					href="/{category.name}"
					class="card bg-azaria-content hover:bg-azaria-content/80 border border-azaria-gold/30 hover:border-azaria-gold transition-all duration-300 hover:scale-105 hover:shadow-gold-glow"
				>
					<div class="card-body text-center">
						<div class="text-4xl mb-3">{category.icon}</div>
						<h3 class="text-xl font-heading text-azaria-gold mb-2">
							{category.title}
						</h3>
						<p class="text-azaria-text/70 font-body text-sm">
							{category.description}
						</p>
					</div>
				</a>
			{/each}
		</div>
	</div>
	
	<!-- Featured Entries -->
	<div class="mb-12">
		<h2 class="text-3xl font-heading text-azaria-gold mb-6 text-center">
			‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
		</h2>
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{#each data.featuredEntries as entry}
				<LoreCard {entry} showCategory={true} />
			{/each}
		</div>
	</div>
	
	<!-- Call to Action -->
	<div class="text-center bg-azaria-content rounded-lg p-8 border border-azaria-gold/30">
		<h2 class="text-2xl font-heading text-azaria-gold mb-4">
			üéØ –ì–æ—Ç–æ–≤—ã –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –º–∏—Ä –ê–∑–∞—Ä–∏–∏?
		</h2>
		<p class="text-azaria-text/80 font-body mb-6 max-w-2xl mx-auto">
			–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –±–æ–≥–∞—Ç—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–º–ø–µ—Ä–∏–π, –ø–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏, 
			–∏–∑—É—á–∏—Ç–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –ø–æ–Ω–∏–º–∞–π—Ç–µ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—é —É–¥–∞—á–∏ –∏ –¥–µ–ø–∞.
		</p>
		<div class="flex flex-wrap justify-center gap-4">
			<a href="/characters" class="btn btn-outline border-azaria-gold text-azaria-gold hover:bg-azaria-gold hover:text-azaria-dark">
				üëë –ù–∞—á–∞—Ç—å —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
			</a>
			<a href="/concepts" class="btn btn-outline border-azaria-gold text-azaria-gold hover:bg-azaria-gold hover:text-azaria-dark">
				üéØ –ü–æ–Ω—è—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
			</a>
		</div>
	</div>
</div>
